<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Functionality Test</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/themes.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
        }
        .test-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
        }
        .test-result {
            margin-top: 1rem;
            padding: 1rem;
            background-color: var(--surface-color);
            border-radius: var(--radius-sm);
        }
        .success { color: var(--success-color); }
        .error { color: var(--error-color); }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Search Functionality Test</h1>
        
        <div class="test-section">
            <h2>1. Global Search Input</h2>
            <div class="search-container">
                <input type="search" id="search-input" class="search-input"
                    placeholder="Search companies or problems..." aria-label="Search companies or problems"
                    autocomplete="off">
                <button class="search-clear" aria-label="Clear search" style="display: none;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="test-result" id="search-test-result">
                <p>Test: Type in the search box and press "/" to test keyboard shortcut</p>
            </div>
        </div>

        <div class="test-section">
            <h2>2. Search Result Highlighting</h2>
            <div class="search-result-card">
                <div class="search-result-header">
                    <span class="company-badge">Google</span>
                    <h4 class="problem-title">Two <mark>Sum</mark> Problem</h4>
                    <span class="difficulty-badge easy">Easy</span>
                </div>
                <div class="problem-topics">
                    <span class="topic-tag">Array</span>
                    <span class="topic-tag">Hash <mark>Table</mark></span>
                </div>
                <div class="problem-meta">
                    <span class="problem-frequency">Frequency: 95.7</span>
                    <span class="problem-acceptance">Acceptance: 55.7%</span>
                    <span class="match-indicator">Title Match</span>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>3. Search Results Grid</h2>
            <div class="search-results-grid">
                <div class="search-result-card solved">
                    <div class="search-result-header">
                        <span class="company-badge">Amazon</span>
                        <h4 class="problem-title">Valid <mark>Parentheses</mark></h4>
                        <span class="difficulty-badge easy">Easy</span>
                    </div>
                    <div class="problem-topics">
                        <span class="topic-tag">String</span>
                        <span class="topic-tag">Stack</span>
                    </div>
                    <div class="problem-meta">
                        <span class="problem-frequency">Frequency: 88.2</span>
                        <span class="problem-acceptance">Acceptance: 40.1%</span>
                        <span class="match-indicator">Title Match</span>
                    </div>
                </div>
                
                <div class="search-result-card bookmarked">
                    <div class="search-result-header">
                        <span class="company-badge">Microsoft</span>
                        <h4 class="problem-title">Longest <mark>Substring</mark> Without Repeating Characters</h4>
                        <span class="difficulty-badge medium">Medium</span>
                    </div>
                    <div class="problem-topics">
                        <span class="topic-tag">Hash Table</span>
                        <span class="topic-tag">String</span>
                        <span class="topic-tag">Sliding Window</span>
                    </div>
                    <div class="problem-meta">
                        <span class="problem-frequency">Frequency: 92.1</span>
                        <span class="problem-acceptance">Acceptance: 33.8%</span>
                        <span class="match-indicator">Title Match</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>4. No Results State</h2>
            <div class="no-search-results">
                <div class="empty-state-content">
                    <svg class="empty-state-icon" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="M21 21l-4.35-4.35"></path>
                    </svg>
                    <h3>No results found</h3>
                    <p>Try adjusting your search terms or browse companies directly.</p>
                    <a href="#/" class="cta-button">Browse Companies</a>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>5. Function Tests</h2>
            <button onclick="testSearchFunctions()" class="cta-button">Run Function Tests</button>
            <div class="test-result" id="function-test-result">
                <p>Click the button above to test search functions</p>
            </div>
        </div>
    </div>

    <!-- Include JavaScript files -->
    <script src="js/utils.js"></script>
    <script src="js/dataManager.js"></script>
    <script src="js/stateManager.js"></script>
    <script src="js/components.js"></script>
    <script src="js/router.js"></script>
    <script src="js/app.js"></script>

    <script>
        // Test search functionality
        function testSearchFunctions() {
            const resultDiv = document.getElementById('function-test-result');
            let results = [];

            try {
                // Test 1: Highlight search term function
                const highlightResult = highlightSearchTerm('Two Sum Problem', 'sum');
                const expectedHighlight = 'Two <mark>Sum</mark> Problem';
                if (highlightResult === expectedHighlight) {
                    results.push('<span class="success">✓ Highlight function works correctly</span>');
                } else {
                    results.push('<span class="error">✗ Highlight function failed</span>');
                }

                // Test 2: Match type label function
                const matchLabel = getMatchTypeLabel('title');
                if (matchLabel === 'Title Match') {
                    results.push('<span class="success">✓ Match type label function works</span>');
                } else {
                    results.push('<span class="error">✗ Match type label function failed</span>');
                }

                // Test 3: Sort search results function
                const testResults = [
                    { title: 'Two Sum', matchType: 'title' },
                    { title: 'Valid Parentheses', matchType: 'company' },
                    { title: 'Add Two Numbers', matchType: 'topic' }
                ];
                const sorted = sortSearchResults(testResults, 'sum');
                if (sorted[0].matchType === 'title') {
                    results.push('<span class="success">✓ Sort search results function works</span>');
                } else {
                    results.push('<span class="error">✗ Sort search results function failed</span>');
                }

                // Test 4: State manager integration
                if (typeof stateManager !== 'undefined' && stateManager) {
                    stateManager.updateSearchQuery('test query');
                    const query = stateManager.getSearchQuery();
                    if (query === 'test query') {
                        results.push('<span class="success">✓ State manager search integration works</span>');
                    } else {
                        results.push('<span class="error">✗ State manager search integration failed</span>');
                    }
                } else {
                    results.push('<span class="error">✗ State manager not available</span>');
                }

                // Test 5: Router integration
                if (typeof RouterUtils !== 'undefined' && RouterUtils) {
                    results.push('<span class="success">✓ Router utils available for search navigation</span>');
                } else {
                    results.push('<span class="error">✗ Router utils not available</span>');
                }

            } catch (error) {
                results.push(`<span class="error">✗ Error during testing: ${error.message}</span>`);
            }

            resultDiv.innerHTML = results.join('<br>');
        }

        // Test keyboard shortcut
        document.addEventListener('keydown', (e) => {
            if (e.key === '/') {
                const searchInput = document.getElementById('search-input');
                if (document.activeElement !== searchInput) {
                    e.preventDefault();
                    searchInput.focus();
                    document.getElementById('search-test-result').innerHTML = 
                        '<span class="success">✓ Keyboard shortcut (/) works correctly</span>';
                }
            }
        });

        // Test search input functionality
        document.getElementById('search-input').addEventListener('input', (e) => {
            const query = e.target.value;
            const clearButton = document.querySelector('.search-clear');
            
            if (query.length > 0) {
                clearButton.style.display = 'block';
                document.getElementById('search-test-result').innerHTML = 
                    `<span class="success">✓ Search input working. Query: "${query}"</span>`;
            } else {
                clearButton.style.display = 'none';
                document.getElementById('search-test-result').innerHTML = 
                    '<p>Test: Type in the search box and press "/" to test keyboard shortcut</p>';
            }
        });

        // Test clear button
        document.querySelector('.search-clear').addEventListener('click', () => {
            document.getElementById('search-input').value = '';
            document.querySelector('.search-clear').style.display = 'none';
            document.getElementById('search-test-result').innerHTML = 
                '<span class="success">✓ Clear button works correctly</span>';
        });

        console.log('Search functionality test page loaded');
    </script>
</body>
</html>